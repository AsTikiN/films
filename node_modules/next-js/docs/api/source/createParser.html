<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/*!
 * Next JS
 *
 * Copyright (c)2012 Xenophy.CO.,LTD All rights Reserved.
 * http://www.xenophy.com
 */

// {{{ NX.Date.createParser

<span id='NX-Date'>/**
</span> * @class NX.Date
 */

<span id='NX-Date-method-createParser'>/**
</span> * @method createParser
 *
 * &quot;write it&quot;
 *
 * @param o {Object} xxx
 * @return {Object}
 */
module.exports = (function() {

    var code = [
        &quot;var dt, y, m, d, h, i, s, ms, o, z, zz, u, v,&quot;,
        &quot;def = NX.Date.defaults,&quot;,
        &quot;results = String(input).match(NX.Date.parseRegexes[{0}]);&quot;,

        &quot;if(results){&quot;,

            &quot;{1}&quot;,
            &quot;if(u != null){&quot;,
                &quot;v = new Date(u * 1000);&quot;,
            &quot;}else{&quot;,
                &quot;dt = NX.Date.clearTime(new Date);&quot;,
                &quot;y = NX.Number.from(y, NX.Number.from(def.y, dt.getFullYear()));&quot;,
                &quot;m = NX.Number.from(m, NX.Number.from(def.m - 1, dt.getMonth()));&quot;,
                &quot;d = NX.Number.from(d, NX.Number.from(def.d, dt.getDate()));&quot;,
                &quot;h  = NX.Number.from(h, NX.Number.from(def.h, dt.getHours()));&quot;,
                &quot;i  = NX.Number.from(i, NX.Number.from(def.i, dt.getMinutes()));&quot;,
                &quot;s  = NX.Number.from(s, NX.Number.from(def.s, dt.getSeconds()));&quot;,
                &quot;ms = NX.Number.from(ms, NX.Number.from(def.ms, dt.getMilliseconds()));&quot;,
                &quot;if(z &gt;= 0 &amp;&amp; y &gt;= 0) {&quot;,
                    &quot;v = NX.Date.add(new Date(y &lt; 100 ? 100 : y, 0, 1, h, i, s, ms), NX.Date.YEAR, y &lt; 100 ? y - 100 : 0);&quot;,
                    &quot;v = !strict? v : (strict === true &amp;&amp; (z &lt;= 364 || (NX.Date.isLeapYear(v) &amp;&amp; z &lt;= 365))? NX.Date.add(v, NX.Date.DAY, z) : null);&quot;,
                &quot;} else if(strict === true &amp;&amp; !NX.Date.isValid(y, m + 1, d, h, i, s, ms)){&quot;,
                    &quot;v = null;&quot;,
                &quot;} else {&quot;,
                    &quot;v = NX.Date.add(new Date(y &lt; 100 ? 100 : y, m, d, h, i, s, ms), NX.Date.YEAR, y &lt; 100 ? y - 100 : 0);&quot;,
                &quot;}&quot;,
            &quot;}&quot;,
        &quot;}&quot;,

        &quot;if(v){&quot;,
            &quot;if(zz != null){&quot;,
                &quot;v = NX.Date.add(v, NX.Date.SECOND, -v.getTimezoneOffset() * 60 - zz);&quot;,
            &quot;} else if(o) {&quot;,
                &quot;v = NX.Date.add(v, NX.Date.MINUTE, -v.getTimezoneOffset() + (sn == '+'? -1 : 1) * (hr * 60 + mn));&quot;,
            &quot;}&quot;,
        &quot;}&quot;,

        &quot;return v;&quot;

    ].join('\n');

    return function(format) {

        var me = this;
        var regexNum = NX.Date.parseRegexes.length,
            currentGroup = 1,
            calc = [],
            regex = [],
            special = false,
            ch = &quot;&quot;;

        for(var i = 0; i &lt; format.length; ++i) {

            ch = format.charAt(i);

            if(!special &amp;&amp; ch == &quot;\\&quot;) {

                special = true;

            } else if(special) {

                special = false;
                regex.push(NX.String.escape(ch));

            } else {

                var obj = NX.Date.formatCodeToRegex(ch, currentGroup);

                currentGroup += obj.g;

                regex.push(obj.s);

                if(obj.g &amp;&amp; obj.c) {

                    calc.push(obj.c);

                }
            }
        }

        NX.Date.parseRegexes[regexNum] = new RegExp(&quot;^&quot; + regex.join('') + &quot;$&quot;, 'i');
        NX.Date.parseFunctions[format] = NX.functionFactory(&quot;input&quot;, &quot;strict&quot;, me.$xf(code, regexNum, calc.join('')));
    };

})();

// }}}

/*
 * Local variables:
 * tab-width: 4
 * c-basic-offset: 4
 * c-hanging-comment-ender-p: nil
 * End:
 */
</pre>
</body>
</html>
