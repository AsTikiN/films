/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/*!
 * Next JS
 *
 * Copyright (c)2012 Xenophy.CO.,LTD All rights Reserved.
 * http://www.xenophy.com
 */

/**
 * @class NX
 * @singleton
 */
(function() {

    if(typeof global.NX === 'undefined') {
        global.NX = {
            global      : global,
            apply       : require('./apply'),
            util        : {},
            $implements : function(target, root) {

                var o = {},
                    fs = require('fs'),
                    path = require('path'),
                    results = [],
                    ret = fs.readdirSync(target);

                if(ret.forEach) {

                    ret.forEach(function(file) {

                        var s = fs.statSync(target + file);

                        file = path.basename(file, '.js');

                        if(file !== 'constructor') {
                            if(!s.isDirectory()) {

                                var name = file,
                                    dp = 'dollar_',
                                    tmp = file.substr(0, dp.length);

                                if(tmp === dp) {
                                    name = '$' + file.substr(dp.length);
                                }

                                o[name] = require(target + file);
                            }

                        } else {
                        }

                    });
                }

                NX.apply(root, o);
            },
            $requires   : {},
            $locale     : require(require('path').normalize(__dirname + '/../locale/en.json'))
        };
    }

    NX.$implements(__dirname + '/', NX);

})();

/*
 * Local variables:
 * tab-width: 4
 * c-basic-offset: 4
 * c-hanging-comment-ender-p: nil
 * End:
 */
